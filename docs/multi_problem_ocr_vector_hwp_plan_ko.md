# 다중 문제 영역 선택 + OCR/벡터화 + HWP 내보내기 설계안

## 한 줄 결론
가능합니다. 다만 **정확도/속도/호환성**을 위해 MVP를 단계적으로 나누는 것이 좋습니다.

---

## 1. 목표 시나리오
사용자 흐름:
1) 사용자가 수학 문제 사진 1장을 업로드
2) 화면에서 문제별 영역(사각형/다각형)을 직접 지정
3) 각 영역마다
   - 텍스트 OCR
   - 도형/수식 이미지 벡터화(SVG)
4) 결과를 문제 단위 블록으로 정리해서 HWP에 자동 배치/삽입

---

## 2. 권장 아키텍처

### 프론트엔드
- 이미지 업로드 + 캔버스 기반 영역 선택(사각형/다각형)
- 영역별 미리보기(원본 / OCR 텍스트 / SVG)
- 영역별 타입 지정(텍스트 중심, 도형 중심, 혼합)

### 백엔드 파이프라인
- 입력: 원본 이미지 + 영역 좌표(JSON)
- 전처리: 기울기 보정, 노이즈 제거, 대비 보정
- OCR: 한국어/수학 혼합 인식
  - 일반 텍스트: Tesseract/PaddleOCR
  - 수식: Mathpix/LaTeX OCR 계열(선택)
- 벡터화:
  - 선/도형 중심: OpenCV contour + 단순화 + SVG path 생성
  - 문자 포함 복합 이미지: 텍스트 레이어 + 도형 레이어 분리 후 병합
- 문서 조립:
  - 문제 단위로 제목/본문/SVG/원본 crop를 구조화
  - HWP 출력 모듈에 전달

### 저장소
- 원본 이미지, 영역 좌표, OCR 결과, SVG, 최종 HWP를 job 단위 저장
- 재처리 가능한 중간산출물(JSON)을 남겨 디버깅/재학습에 활용

---

## 3. HWP 생성 전략(현실적인 선택)

### A안: HWPX(권장)
- HWPX(XML 기반)로 구성요소를 생성
- 텍스트와 이미지(SVG->PNG 변환 또는 지원 포맷)를 문제 블록 단위로 삽입
- 장점: 자동화/버전관리 친화적
- 단점: 세부 레이아웃 구현에 학습 필요

### B안: Windows 한글 COM 자동화
- 한글 프로그램 설치 환경에서 문서 자동 작성
- 장점: 실제 사용자 환경과 결과 일치도가 높음
- 단점: 서버/운영환경 제약 큼(Windows 종속)

### C안: 중간 포맷(docx/pdf) 후 변환
- 초기 MVP는 docx/pdf 생성 후 수동/도구 변환
- 장점: 빠른 MVP
- 단점: 최종 HWP 품질/자동화 일관성 낮아질 수 있음

---

## 4. MVP 범위(추천)

### MVP-1 (2~4주)
- 직사각형 영역 선택
- 영역별 OCR 텍스트 추출
- 원본 crop 이미지를 HWPX에 순서대로 삽입
- 실패한 영역 재시도 UI

### MVP-2
- 다각형 영역 선택
- 도형 벡터화(SVG) + 텍스트 분리
- 문제 번호 자동 감지/정렬

### MVP-3
- 수식 특화 OCR(LaTeX)
- 벡터 후처리(선분 직선화, 원/호 인식)
- 정답/해설 템플릿 자동 배치

---

## 5. 핵심 난점과 대응
- 수학 기호 OCR 정확도: 엔진 앙상블 + 사전/후처리 규칙
- 손그림/인쇄 혼합: 영역 타입을 사용자에게 선택받아 파이프라인 분기
- HWP 호환성: MVP 단계에서 HWPX 샘플 템플릿 고정 후 확장
- 처리시간: 영역 단위 비동기 큐(병렬 처리) + 캐시

---

## 6. 최소 데이터 구조 예시

```json
{
  "job_id": "job_001",
  "image": "input.jpg",
  "regions": [
    {
      "id": "q1",
      "polygon": [[120,80],[980,80],[980,430],[120,430]],
      "type": "mixed"
    }
  ]
}
```

출력 예시:
- `q1.txt` (OCR 텍스트)
- `q1.svg` (벡터화 결과)
- `result.hwpx` 또는 `result.hwp` (최종 문서)

---

## 7. 바로 시작 가능한 구현 순서
1) 웹에서 영역 지정 UI 구현
2) 영역 crop + OCR API 연결
3) HWPX 템플릿 1종 제작(문제 블록 반복)
4) SVG 생성기(도형 단순 벡터화) 추가
5) 품질 리포트(문제별 정확도/실패율) 대시보드화

---

## 8. 결론
요구하신 기능은 충분히 구현 가능합니다.
실무적으로는 **영역 선택 → OCR 안정화 → HWP 내보내기**를 먼저 완성하고,
그 다음에 도형 벡터화 정밀도를 올리는 순서가 가장 성공 확률이 높습니다.
